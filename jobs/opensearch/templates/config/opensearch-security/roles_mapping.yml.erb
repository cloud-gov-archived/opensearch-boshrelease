---
# In this file users, backendroles and hosts can be mapped to Security roles.
# Permissions for OpenSearch roles are configured in roles.yml

<%
# Load roles from file
role_file = "/var/vcap/store/opensearch/jason.txt"
roles = File.exist?(role_file) ? File.read(role_file).split("\n": [])
%>

_meta:
  type: "rolesmapping"
  config_version: 2

# Define your roles mapping here

## Demo roles mapping

all_access:
  reserved: false
  backend_roles:
  - "admin"
  description: "Maps admin to all_access"

own_index:
  reserved: false
  users:
  - "*"
  description: "Allow full access to an index named like the username"

index_management_full_access:
  reserved: false
  hidden: false
  users:
  - "logstash.opensearch.internal"

logstash:
  reserved: false
  hidden: false
  users:
  - "logstash.opensearch.internal"
  backend_roles:
  - "logstash"

kibana_user:
  reserved: false
  backend_roles:
  - "kibanauser"
  - "user"
  description: "Maps kibanauser to kibana_user"

cf_user:
  reserved: true
  hidden: false
  backend_roles:
  <% roles.each do |role| %>
    - <%= role.to_json %>
  <% end %>
  hosts: []
  users: []
  and_backend_roles: []
  description: "CF users with privileges to their own spaces"

reports_full_access:
  reserved: true
  hidden: false
  backend_roles:
  - "user"
  hosts: []
  users: []
  and_backend_roles: []
  description: "CF users with report access"

readall:
  reserved: false
  users:
  - "smoketest.opensearch.internal"
  backend_roles:
  - "readall"

manage_snapshots:
  reserved: false
  backend_roles:
  - "snapshotrestore"

kibana_server:
  reserved: true
  users:
  - "kibanaserver"
  # Give permission for Dashboards to access Opensearch
  - "dashboard.opensearch.internal"